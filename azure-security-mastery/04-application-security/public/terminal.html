<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêö Cloud Minishell - 42 Project</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0c0c0c;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: #1a1a1a;
            padding: 15px 10px;
            border-bottom: 2px solid #00ff00;
            text-align: center;
            min-height: 60px;
            box-sizing: border-box;
            position: relative;
            z-index: 10;
            flex-shrink: 0;
        }
        
        .header h1 {
            margin: 0;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
            font-size: 1.5em;
            line-height: 1.2;
        }
        
        .subtitle {
            color: #888;
            margin: 8px 0 0 0;
            font-size: 0.9em;
            line-height: 1.2;
        }
        
        #terminal {
            width: 100%;
            background: #0c0c0c;
            border: none;
            outline: none;
            padding: 20px;
            box-sizing: border-box;
            font-size: 14px;
            line-height: 1.4;
            resize: none;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            flex: 1;
        }
        
        .terminal-container {
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .cursor {
            background: #00ff00;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            50% { opacity: 0; }
        }
        
        .command-line {
            color: #00ff00;
        }
        
        .output {
            color: #ffffff;
        }
        
        .error {
            color: #ff4444;
        }
        
        .welcome {
            color: #00bbff;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üêö Cloud Minishell</h1>
        <p class="subtitle">42 School Project - Now in the Cloud!</p>
    </div>
    
    <div class="terminal-container">
        <div id="terminal"></div>
        <input type="text" id="input" style="position: absolute; left: -9999px;" autocomplete="off">
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const terminal = document.getElementById('terminal');
        const input = document.getElementById('input');
        
        let connected = false;
        
        // Focus on input
        input.focus();
        
        // Prevent context menu
        document.addEventListener('contextmenu', e => e.preventDefault());
        
        // Keep input focused
        document.addEventListener('click', () => input.focus());
        
        // Handle socket events
        socket.on('output', (data) => {
            appendToTerminal(data, 'output');
        });
        
        socket.on('connect', () => {
            connected = true;
            appendToTerminal('üîå Connected to cloud minishell!\n', 'welcome');
        });
        
        socket.on('disconnect', () => {
            connected = false;
            appendToTerminal('üíî Disconnected from server. Refresh to reconnect.\n', 'error');
        });
        
        // Simplified keyboard input - just pass everything through
        input.addEventListener('keydown', (e) => {
            if (!connected) return;
            
            // Prevent default for all handled keys
            e.preventDefault();
            
            switch(e.key) {
                case 'Enter':
                    socket.emit('input', '\r');
                    break;
                    
                case 'Backspace':
                    socket.emit('input', '\x08');
                    break;
                    
                case 'Tab':
                    socket.emit('input', '\t');
                    break;
                    
                case 'ArrowLeft':
                    socket.emit('input', '\x1b[D');
                    break;
                    
                case 'ArrowRight':
                    socket.emit('input', '\x1b[C');
                    break;
                    
                case 'ArrowUp':
                    socket.emit('input', '\x1b[A');
                    break;
                    
                case 'ArrowDown':
                    socket.emit('input', '\x1b[B');
                    break;
                    
                case 'Escape':
                    socket.emit('input', '\x1b');
                    break;
                    
                default:
                    // Handle Ctrl combinations
                    if (e.ctrlKey) {
                        switch(e.key.toLowerCase()) {
                            case 'c':
                                socket.emit('input', '\x03');
                                break;
                            case 'd':
                                socket.emit('input', '\x04');
                                break;
                            case 'l':
                                terminal.innerHTML = '';
                                break;
                            case 'z':
                                socket.emit('input', '\x1a');
                                break;
                        }
                    } else if (e.key.length === 1) {
                        // Send regular characters directly
                        socket.emit('input', e.key);
                    }
                    break;
            }
        });
        
        function appendToTerminal(text, className = '') {
            // Filter out unwanted ANSI escape sequences but keep colors
            let cleanText = text
                .replace(/\x1b\[\?2004[hl]/g, '') // Remove bracketed paste mode
                .replace(/\x1b\[K/g, '')          // Remove clear line
                .replace(/\x1b\[\d*[ABCD]/g, '')  // Remove cursor movement (but allow in limited cases)
                .replace(/\x1b\[\d*[JK]/g, '');   // Remove clear screen/line sequences
            
            // Only append if there's actual content after cleaning
            if (cleanText) {
                const span = document.createElement('span');
                span.textContent = cleanText;
                if (className) {
                    span.className = className;
                }
                terminal.appendChild(span);
            }
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const cols = Math.floor(terminal.clientWidth / 8);
            const rows = Math.floor(terminal.clientHeight / 20);
            socket.emit('resize', { cols, rows });
        });
        
        // Initial resize
        setTimeout(() => {
            const cols = Math.floor(terminal.clientWidth / 8);
            const rows = Math.floor(terminal.clientHeight / 20);
            socket.emit('resize', { cols, rows });
        }, 100);
    </script>
</body>
</html>
